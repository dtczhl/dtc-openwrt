#!/bin/bash


sleepTime=300

sendLength=2000

queueSizeList=(1024 1854 3354 6068 10978 19864 35940 65034 117678 212992)

# get filename of this script
MY_FILENAME="$(basename "$0")"

usage (){
cat <<EOF
$MY_FILENAME
    --client
    --server
EOF
}

argumentProcess (){
    
    if [ $# -eq 0 ]; then
        # show help info
        usage
        exit
    fi

    key="$1"
    case $key in
    --server) # server
        queueSize=${queueSizeList[-1]}
        echo $queueSize 
        sed -i -e "s/queueSize=.*/queueSize=${queueSize}/" /bin/dtcUdpTxRxDataCollector
        dtcUdpTxRxDataCollector -l &
        ;;
    --client) # client
        for i in ${queueSizeList[*]}; do
            queueSize=$i
            echo $queueSize 
            sed -i -e "s/queueSize=.*/queueSize=${queueSize}/" /bin/dtcUdpTxRxDataCollector
            dtcUdpTxRxDataCollector -r &
            sleep 300
            dtcUdpTxRxDataCollector -s
        done 
        ;;
    *) 
        echo "Unknow argument $key"
        exit
        ;;
    esac

}

argumentProcess $@
