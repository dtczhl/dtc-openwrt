#!/bin/bash


sleepTime=300

sendLengthList=(1800)

queueSizeList=(212992)

# get filename of this script
MY_FILENAME="$(basename "$0")"

usage (){
cat <<EOF
$MY_FILENAME
    --client
    --server
EOF
}

argumentProcess (){
    
    if [ $# -eq 0 ]; then
        # show help info
        usage
        exit
    fi

    key="$1"
    case $key in
    --server) # server
        queueSize=${queueSizeList[-1]}
        echo $queueSize 
        sed -i -e "s/queueSize=.*/queueSize=${queueSize}/" /bin/dtcUdpTxRxDataCollector
        dtcUdpTxRxDataCollector -l &
        ;;
    --client) # client
        # for i in ${queueSizeList[*]}; do
        queueSize=${queueSizeList[-1]}
        for i in ${sendLengthList[*]}; do
            sendLength=$i
            echo $sendLength
            sed -i -e "s/queueSize=.*/queueSize=${queueSize}/" /bin/dtcUdpTxRxDataCollector
            sed -i -e "s/sendLength=.*/sendLength=${sendLength}/" /bin/dtcUdpTxRxDataCollector
            dtcUdpTxRxDataCollector -r &
            sleep 600
            dtcUdpTxRxDataCollector -s
        done 
        ;;
    *) 
        echo "Unknow argument $key"
        exit
        ;;
    esac

}

argumentProcess $@
